# 产品需求文档 (PRD): 亚马逊竞品情报系统 V1.3 (钉钉版)

| 文档版本 | V1.3 (钉钉版) |
| :--- | :--- |
| **项目名称** | 亚马逊竞品情报系统 (Project Spyglass) |
| **创建日期** | 2025年10月30日 (修订) |
| **目标** | 打造一个7x24小时运行的自动化竞品监控引擎，通过API驱动和AI辅助的UI，为**个人运营者**提供关键决策情报并解放生产力。 |

---

## 1. 简介

### 1.1. 问题陈述 (The Problem)
我（作为亚马逊运营）目前依赖**手动、重复**的劳动来跟踪竞品。这包括每天打开数十个ASIN页面，检查价格变动、新差评、BSR排名和库存情况。这个过程极其耗时、容易出错、缺乏数据沉淀，并且总是**被动响应**而非**主动预警**。

### 1.2. 解决方案 (The Solution)
“亚马逊竞品情报系统”是一个个人SaaS工具。它通过**自动化Web爬虫**，7x24小时抓取、存储和分析竞品数据。系统将通过一个**现代Web界面**（由AI辅助生成）展示历史趋势和变化对比，并通过**钉钉**发送**主动警报**。

### 1.3. V1.0 核心目标 (Goals & Objectives)
1.  **效率提升：** 释放我每天1-2小时的手动跟踪时间。
2.  **主动决策：** 将我从“被动查看”转变为“主动收到警报”，在竞品行动（如调价、断货）的**第一时间**做出反应。
3.  **数据沉淀：** 建立竞品历史数据库，用于复盘和战略分析。

### 1.4. 范围 (Scope)

| V1.0 范围内 (In-Scope) | V1.0 范围外 (Out-of-Scope) |
| :--- | :--- |
| ✅ 基于Web爬虫的数据抓取 | ❌ **认证与安全 (F-MOD-1)** (V2.0 考虑) |
| ✅ 关键数据点（**标题、五点**、价格、BSR、评论、库存、A+、主图）| ❌ 任何官方亚马逊SP-API/MWS的集成 |
| ✅ 历史数据存储和图表化展示 (MySQL) | ❌ 自动化亚马逊后台操作（如自动调价） |
| ✅ **钉钉**主动警报 | ❌ **后端负责HTML Diff高亮** (移至前端实现) |
| ✅ API First 架构（Spring Boot RESTful API） | ❌ 抓取关键词搜索排名 (V2.0 考虑) |
| ✅ AI辅助生成的Web前端（React/Vue） | ❌ 抓取亚马逊以外的平台（如eBay, Walmart） |

---

## 2. 用户画像与核心场景 (User Personas & Stories)

* **画像1：Alex（我，亚马逊运营兼开发者）**
    * **痛点：** “我每天早上要花1小时开20个竞品Tab页，生怕他们降价或上了差评我不知道。我受够了复制粘贴到Excel里。”
    * **需求：** “我需要一个（跑在我的服务器上的）仪表盘，一眼就能看到所有竞品‘昨天发生了什么’。并且，如果他们有动作，立刻通知我！”

| 优先级 | 作为... (Persona) | 我想要... (Action) | 以便我能... (Goal) |
| :--- | :--- | :--- | :--- |
| **P0** | 我 (运营) | 访问仪表盘，列出我所有监控的ASIN | 快速了解大盘情况。 |
| **P0** | 我 (运营) | 在仪表盘上看到哪些ASIN**发生了变化**（如价格、差评） | 优先处理最重要的信息。 |
| **P0** | 我 (运营) | 添加一个新的竞品ASIN进行监控 | 扩展我的情报网络。 |
| **P0** | 我 (运营) | 当一个竞品**价格变动**或**库存低于阈值**时 | **立即**在我的**钉钉群**里收到**纯文本通知**。 |
| **P0** | 我 (运营) | 当竞品**标题或五点**发生变化时 | 在**钉钉**中收到**变更通知**（前端负责高亮对比）。 |
| **P1** | 我 (运营) | 当一个竞品**获得了新的1-3星差评**时 | **立即**在**钉钉**中收到通知，并查看差评内容，以便分析他们的弱点。 |
| **P1** | 我 (运营) | 点击任意一个ASIN，查看它的**历史价格和BSR曲线** | 分析它的长期策略和销售趋势。 |
| **P1** | 我 (开发) | 通过**API文档**（Swagger）来测试后端 | 确保后端按预期工作，并指导AI生成前端。 |
| **P2** | 我 (运营) | 收到竞品**主图或A+内容变更**的警报 | 了解他们是否在测试新的营销素材。 |

---

## 3. 功能需求 (Functional Requirements)

### F-MOD-1: 认证 & 安全 (Auth)
* **F-AUTH-001 (V2.0):** (V2.0) 系统提供基于用户名和密码的登录功能。
* **(V1.0 策略):** V1.0 假设系统部署在**受信任的私有网络**中，不暴露于公网。

### F-MOD-2: ASIN管理 (Management)
* **F-ASIN-001 (仪表盘):** 用户访问UI应看到一个“ASIN列表”仪表盘。
* **F-ASIN-002 (列表项):** 列表中的每一项应展示ASIN的**最新关键数据**：名称、ASIN、主图、当前价格、当前BSR、评论数、预估库存。
* **F-ASIN-003 (警报标识):** 列表项必须有明显的**视觉标识**，表明该ASIN在最近一次抓取中是否触发了警报。
* **F-ASIN-004 (添加ASIN):** 用户必须能通过一个表单添加新的ASIN。
    * **输入字段：** ASIN (字符串), 站点 (下拉框: US, UK等), 昵称 (字符串), 库存警报阈值 (数字)。
* **F-ASIN-005 (删除ASIN):** 用户必须能从仪表盘中删除一个ASIN。
* **F-ASIN-006 (详情页):** 点击任意ASIN，应跳转到该ASIN的“详情页”。

### F-MOD-3: 爬虫引擎 (Scraper Engine) - (后端)
* **F-SCRAPE-001 (定时调度):** 系统必须有一个定时任务调度器（`@Scheduled`），按预设频率（例如：每4小时）自动为列表中的所有ASIN执行抓取。
* **F-SCRAPE-002 (异步执行):** 抓取任务必须是异步的（`@Async`），确保单个ASIN的抓取失败不会阻塞整个队列。
* **F-SCRAPE-003 (代理集成 - 关键):** **所有**对亚马逊的HTTP/S请求**必须**通过**旋转住宅IP代理服务**（如 Bright Data）发出。
* **F-SCRAPE-004 (静态抓取 - Jsoup):** 引擎必须能抓取以下静态数据：
    * 价格 (Buybox价格)
    * BSR (大类目排名)
    * **[新增] 五点描述 (Bullet Points)** (存储为JSON或TEXT)
    * 评论总数
    * 平均星级
    * 主图URL (用于MD5 HASH对比)
    * A+ 内容区域的原始HTML (用于MD5 HASH对比)
* **F-SCRAPE-005 (动态抓取 - Selenium):** 引擎必须能使用Selenium模拟浏览器行为，执行“999加购法”来抓取**预估库存**。
* **F-SCRAPE-006 (差评抓取):** 引擎必须能抓取最新10条评论，并筛选出1-3星的评论（包括内容和日期）。
* **F-SCRAPE-007 (数据存储):** 每次抓取成功后，所有数据点（价格、BSR、库存、**五点**等）必须连同**时间戳**一起存入**MySQL**数据库。

### F-MOD-4: 警报与数据 (Alert & Data Engine)
* **F-DATA-001 (数据对比):** 在每次新数据（F-SCRAPE-007）存入后，系统必须立即将其与**上一次**的抓取数据（从 `asinHistoryRepository` 获取）进行对比。
* **F-DATA-002 (警报触发器 - 价格):** `newPrice != oldPrice` -> 触发警报。
* **F-DATA-003 (警报触发器 - 库存):** `newInventory < inventoryThreshold` (F-ASIN-004中设置的阈值) -> 触发警报。
* **F-DATA-004 (警报触发器 - 差评):** `newNegativeReview` (在数据库中未见过的差评) -> 触发警报。
* **F-DATA-005 (警报触发器 - 主图):** `MD5(newImageUrl) != MD5(oldImageUrl)` -> 触发警报。
* **F-DATA-006 (警报触发器 - 标题/五点/A+):** `MD5(newText) != MD5(oldText)` -> 触发警报。
* **F-DATA-007 (推送器 - 钉钉):**
    * 所有被触发的警报，必须被格式化为 **纯文本消息**。
    * **推送目标：** 通过 `dingtalk.webhook` 配置。
    * **通知内容：** 简洁明了（例如：“ASIN [XXX] 价格变动: $19.99 -> $21.99”，“ASIN [YYY] 标题已变更”）。
    * **(V2.0)** 前端应负责获取新旧数据并进行Diff高亮展示。
* **F-DATA-008 (历史曲线):** ASIN详情页（F-ASIN-006）必须能调用API，获取该ASIN的**历史数据**（价格、BSR、库存），并在前端使用**图表库 (Chart.js)** 绘制成折线图。

### F-MOD-5: API 端点 (API Endpoints) - (供AI生成前端使用)
* **F-API-001 (OpenAPI):** 系统必须使用 `springdoc-openapi` 自动生成 `/v3/api-docs` (OpenAPI 3.0 JSON) 规范。
* **F-API-002 (Auth - V2.0):** (V2.0 优先级)
* **F-API-003 (ASIN Management):** (V1.0 开放)
    * `GET /api/asin`
    * `POST /api/asin`
    * `DELETE /api/asin/{id}`
    * `PUT /api/asin/{id}/config`
* **F-API-004 (Data Query):** (V1.0 开放)
    * `GET /api/asin/{id}/history?range=30d`
* **(V2.0)** `GET /api/data/alerts` (获取全局警报日志列表)

---

## 4. 非功能性需求 (Non-Functional Requirements, NFRs)

| 类别 | 需求 (NFR) |
| :--- | :--- |
| **性能** | **NFR-P-001:** API 响应时间 (非爬虫) 必须在 500ms 以下。 |
| | **NFR-P-002:** 仪表盘页面 (UI) 加载时间必须在 3 秒以下。 |
| | **NFR-P-003:** 单个ASIN的全量抓取（含Selenium）应在 90 秒内完成。 |
| **安全** | **NFR-S-001 (V2.0):** (V2.0) 所有Web流量必须使用 **HTTPS (SSL)**。 |
| | **NFR-S-002:** 所有敏感密钥（数据库密码、代理APIKey、**钉钉Webhook**）**绝不能**硬编码在代码中，必须使用环境变量或 `.properties` 文件注入。 |
| | **NFR-S-003 (V1.0):** V1.0 系统假定部署在私有网络，如需公网访问，**必须**由Nginx层配置IP白名单或Basic Auth。 |
| **可靠性** | **NFR-R-001:** 爬虫必须有**重试机制**（如抓取失败，30分钟后重试1次）。(当前缺失) |
| | **NFR-R-002:** 系统应7x24小时运行，Docker容器必须配置为 `restart: always`。 |
| | **NFR-R-003:** 数据库数据必须**持久化**（使用Docker Volume）。 |
| **配置** | **NFR-C-001:** 必须在 `application.yml` 中提供 **钉钉Webhook** (`dingtalk.webhook`) 的配置项。 |
| **部署** | **NFR-D-001:** 整个应用（后端、**MySQL**数据库、Nginx）必须通过 `docker-compose.yml` **一键编排**。 |
| | **NFR-D-002:** Nginx必须配置为反向代理：`your.domain.com/` 指向前端静态文件，`your.domain.com/api/` 指向Spring Boot后端。 |
| **技术栈** | **NFR-T-001:** 数据库统一使用 **MySQL 8**，应用方言使用 `org.hibernate.dialect.MySQL8Dialect`，驱动使用 `mysql-connector-j`。 |

---

## 5. V1.0 启动标准 (修订)

* 所有 **P0** 和 **P1** 级别的用户故事均已实现并通过测试。
* F-MOD-2, F-MOD-3, F-MOD-4, F-MOD-5 中定义的核心功能均已实现。
* `springdoc-openapi` 文档已自动生成且内容准确。
* **钉钉警报**（价格、差评、库存、**五点、标题**）推送功能稳定。
* AI已成功生成一个可用的前端界面（仪表盘、详情页）。
* 已成功在**线上服务器**（美国）通过Docker Compose部署，并集成了**付费住宅代理**。
* **(已解决)** 数据库技术栈统一为 **MySQL**。
* **(已降级)** 登录认证 (F-MOD-1) 移至 V2.0。