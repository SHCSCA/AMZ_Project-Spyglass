<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/spyglass-backend/src/test/java/com/amz/spyglass/scraper/ScrapeParserTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/spyglass-backend/src/test/java/com/amz/spyglass/scraper/ScrapeParserTest.java" />
              <option name="originalContent" value="package com.amz.spyglass.scraper;&#10;&#10;import org.jsoup.Jsoup;&#10;import org.jsoup.nodes.Document;&#10;import org.junit.jupiter.api.Test;&#10;&#10;import java.math.BigDecimal;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;&#10;/**&#10; * ScrapeParser 单元测试（中文注释）&#10; * 使用本地 HTML 片段验证解析器对 title/price/bsr/inventory/imageMd5/aplusMd5 的提取。&#10; */&#10;public class ScrapeParserTest {&#10;&#10;    @Test&#10;    public void parse_basicHtml_shouldExtractFields() {&#10;        String html = &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Test Product&lt;/title&gt;&lt;/head&gt;&quot;&#10;                + &quot;&lt;body&gt;&quot;&#10;                + &quot;&lt;span id=\&quot;priceblock_ourprice\&quot;&gt;$12.34&lt;/span&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;detailBullets_feature_div\&quot;&gt;&lt;ul&gt;&lt;li&gt;Best Sellers Rank: #1,234 in Books&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;availability\&quot;&gt;In Stock.&lt;/div&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;imgTagWrapperId\&quot;&gt;&lt;img src=\&quot;https://example.com/image.jpg\&quot; /&gt;&lt;/div&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;aplus\&quot;&gt;&lt;p&gt;A+&lt;/p&gt;&lt;/div&gt;&quot;&#10;                + &quot;&lt;/body&gt;&lt;/html&gt;&quot;;&#10;&#10;        Document doc = Jsoup.parse(html);&#10;        AsinSnapshotDTO s = ScrapeParser.parse(doc);&#10;&#10;        assertEquals(&quot;Test Product&quot;, s.getTitle());&#10;        assertNotNull(s.getPrice());&#10;        assertEquals(new BigDecimal(&quot;12.34&quot;), s.getPrice());&#10;        assertNotNull(s.getBsr());&#10;        assertEquals(1234, s.getBsr());&#10;        // inventory: In Stock 没有精确数字，解析器返回 null&#10;        assertNull(s.getInventory());&#10;        assertNotNull(s.getImageMd5());&#10;        assertNotNull(s.getAplusMd5());&#10;    }&#10;&#10;    @Test&#10;    public void parse_richHtml_shouldExtractExtendedFields() {&#10;        String html = &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Fire TV Stick&lt;/title&gt;&lt;/head&gt;&quot;&#10;                + &quot;&lt;body&gt;&quot;&#10;                // 价格使用 a-price 结构&#10;                + &quot;&lt;span class='a-price' data-a-color='price'&gt;&lt;span class='a-offscreen'&gt;$45.99&lt;/span&gt;&lt;/span&gt;&quot;&#10;                // BSR 使用备用 SalesRank 节点&#10;                + &quot;&lt;div id='SalesRank'&gt;Best Sellers Rank: #2,345 in Electronics (See Top 100)&lt;/div&gt;&quot;&#10;                // 库存提示仅剩&#10;                + &quot;&lt;div id='availability'&gt;Only 7 left in stock.&lt;/div&gt;&quot;&#10;                // 主图&#10;                + &quot;&lt;div id='imgTagWrapperId'&gt;&lt;img src='https://cdn.example.com/prod/main-image.png' /&gt;&lt;/div&gt;&quot;&#10;                // 五点要点&#10;                + &quot;&lt;div id='feature-bullets'&gt;&lt;ul&gt;&quot;&#10;                + &quot;&lt;li class='a-list-item'&gt;Fast streaming&lt;/li&gt;&quot;&#10;                + &quot;&lt;li class='a-list-item'&gt;Alexa Voice Remote&lt;/li&gt;&quot;&#10;                + &quot;&lt;li class='a-list-item'&gt;Dolby Atmos support&lt;/li&gt;&quot;&#10;                + &quot;&lt;/ul&gt;&lt;/div&gt;&quot;&#10;                // A+ 内容块&#10;                + &quot;&lt;div class='aplus'&gt;&lt;div class='module'&gt;Enhanced details&lt;/div&gt;&lt;/div&gt;&quot;&#10;                // 评论总数&#10;                + &quot;&lt;span id='acrCustomerReviewText'&gt;1,234 ratings&lt;/span&gt;&quot;&#10;                // 平均评分&#10;                + &quot;&lt;span data-hook='rating-out-of-text'&gt;4.6 out of 5&lt;/span&gt;&quot;&#10;                // 差评区域（模拟两个评论，第二个为 2 星差评）&#10;                + &quot;&lt;div class='a-section review'&gt;&quot;&#10;                + &quot;  &lt;span class='a-icon-alt'&gt;5.0 out of 5 stars&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-date'&gt;Reviewed on Oct 1 2025&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-text'&gt;Great product!&lt;/span&gt;&quot;&#10;                + &quot;&lt;/div&gt;&quot;&#10;                + &quot;&lt;div class='a-section review'&gt;&quot;&#10;                + &quot;  &lt;span class='a-icon-alt'&gt;2.0 out of 5 stars&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-date'&gt;Reviewed on Oct 2 2025&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-text'&gt;Stopped working after a week.&lt;/span&gt;&quot;&#10;                + &quot;&lt;/div&gt;&quot;&#10;                + &quot;&lt;/body&gt;&lt;/html&gt;&quot;;&#10;&#10;        org.jsoup.nodes.Document doc = org.jsoup.Jsoup.parse(html);&#10;        AsinSnapshotDTO s = ScrapeParser.parse(doc);&#10;&#10;        // 标题&#10;        assertEquals(&quot;Fire TV Stick&quot;, s.getTitle());&#10;        // 价格&#10;        assertEquals(new java.math.BigDecimal(&quot;45.99&quot;), s.getPrice());&#10;        // BSR&#10;        assertEquals(2345, s.getBsr());&#10;        // 库存（解析出仅剩数量）&#10;        assertEquals(7, s.getInventory());&#10;        // 主图 MD5&#10;        assertNotNull(s.getImageMd5());&#10;        // A+ 内容 MD5&#10;        assertNotNull(s.getAplusMd5());&#10;        // 五点要点包含三行&#10;        assertNotNull(s.getBulletPoints());&#10;        String[] bulletLines = s.getBulletPoints().split(&quot;\n&quot;);&#10;        assertEquals(3, bulletLines.length);&#10;        // 评论总数与评分&#10;        assertEquals(1234, s.getTotalReviews());&#10;        assertEquals(new java.math.BigDecimal(&quot;4.6&quot;), s.getAvgRating());&#10;        // 差评 MD5 应存在&#10;        assertNotNull(s.getLatestNegativeReviewMd5());&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.amz.spyglass.scraper;&#10;&#10;import org.jsoup.Jsoup;&#10;import org.jsoup.nodes.Document;&#10;import org.junit.jupiter.api.Test;&#10;&#10;import java.math.BigDecimal;&#10;&#10;import static org.junit.jupiter.api.Assertions.*;&#10;&#10;/**&#10; * ScrapeParser 单元测试（中文注释）&#10; * 使用本地 HTML 片段验证解析器对 title/price/bsr/inventory/imageMd5/aplusMd5 的提取。&#10; */&#10;public class ScrapeParserTest {&#10;&#10;    @Test&#10;    public void parse_basicHtml_shouldExtractFields() {&#10;        String html = &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Test Product&lt;/title&gt;&lt;/head&gt;&quot;&#10;                + &quot;&lt;body&gt;&quot;&#10;                + &quot;&lt;span id=\&quot;priceblock_ourprice\&quot;&gt;$12.34&lt;/span&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;detailBullets_feature_div\&quot;&gt;&lt;ul&gt;&lt;li&gt;Best Sellers Rank: #1,234 in Books&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;availability\&quot;&gt;In Stock.&lt;/div&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;imgTagWrapperId\&quot;&gt;&lt;img src=\&quot;https://example.com/image.jpg\&quot; /&gt;&lt;/div&gt;&quot;&#10;                + &quot;&lt;div id=\&quot;aplus\&quot;&gt;&lt;p&gt;A+&lt;/p&gt;&lt;/div&gt;&quot;&#10;                + &quot;&lt;/body&gt;&lt;/html&gt;&quot;;&#10;&#10;        Document doc = Jsoup.parse(html);&#10;        AsinSnapshotDTO s = ScrapeParser.parse(doc);&#10;&#10;        assertEquals(&quot;Test Product&quot;, s.getTitle());&#10;        assertNotNull(s.getPrice());&#10;        assertEquals(new BigDecimal(&quot;12.34&quot;), s.getPrice());&#10;        assertNotNull(s.getBsr());&#10;        assertEquals(1234, s.getBsr());&#10;        // inventory: In Stock 没有精确数字，解析器返回 null&#10;        assertNull(s.getInventory());&#10;        assertNotNull(s.getImageMd5());&#10;        assertNotNull(s.getAplusMd5());&#10;    }&#10;&#10;    @Test&#10;    public void parse_richHtml_shouldExtractExtendedFields() {&#10;        String html = &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Fire TV Stick&lt;/title&gt;&lt;/head&gt;&quot;&#10;                + &quot;&lt;body&gt;&quot;&#10;                // 价格使用 a-price 结构&#10;                + &quot;&lt;span class='a-price' data-a-color='price'&gt;&lt;span class='a-offscreen'&gt;$45.99&lt;/span&gt;&lt;/span&gt;&quot;&#10;                // BSR 使用备用 SalesRank 节点&#10;                + &quot;&lt;div id='SalesRank'&gt;Best Sellers Rank: #2,345 in Electronics (See Top 100)&lt;/div&gt;&quot;&#10;                // 库存提示仅剩&#10;                + &quot;&lt;div id='availability'&gt;Only 7 left in stock.&lt;/div&gt;&quot;&#10;                // 主图&#10;                + &quot;&lt;div id='imgTagWrapperId'&gt;&lt;img src='https://cdn.example.com/prod/main-image.png' /&gt;&lt;/div&gt;&quot;&#10;                // 五点要点&#10;                + &quot;&lt;div id='feature-bullets'&gt;&lt;ul&gt;&quot;&#10;                + &quot;&lt;li class='a-list-item'&gt;Fast streaming&lt;/li&gt;&quot;&#10;                + &quot;&lt;li class='a-list-item'&gt;Alexa Voice Remote&lt;/li&gt;&quot;&#10;                + &quot;&lt;li class='a-list-item'&gt;Dolby Atmos support&lt;/li&gt;&quot;&#10;                + &quot;&lt;/ul&gt;&lt;/div&gt;&quot;&#10;                // A+ 内容块&#10;                + &quot;&lt;div class='aplus'&gt;&lt;div class='module'&gt;Enhanced details&lt;/div&gt;&lt;/div&gt;&quot;&#10;                // 评论总数&#10;                + &quot;&lt;span id='acrCustomerReviewText'&gt;1,234 ratings&lt;/span&gt;&quot;&#10;                // 平均评分&#10;                + &quot;&lt;span data-hook='rating-out-of-text'&gt;4.6 out of 5&lt;/span&gt;&quot;&#10;                // 差评区域（模拟两个评论，第二个为 2 星差评）&#10;                + &quot;&lt;div class='a-section review'&gt;&quot;&#10;                + &quot;  &lt;span class='a-icon-alt'&gt;5.0 out of 5 stars&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-date'&gt;Reviewed on Oct 1 2025&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-text'&gt;Great product!&lt;/span&gt;&quot;&#10;                + &quot;&lt;/div&gt;&quot;&#10;                + &quot;&lt;div class='a-section review'&gt;&quot;&#10;                + &quot;  &lt;span class='a-icon-alt'&gt;2.0 out of 5 stars&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-date'&gt;Reviewed on Oct 2 2025&lt;/span&gt;&quot;&#10;                + &quot;  &lt;span class='review-text'&gt;Stopped working after a week.&lt;/span&gt;&quot;&#10;                + &quot;&lt;/div&gt;&quot;&#10;                + &quot;&lt;/body&gt;&lt;/html&gt;&quot;;&#10;&#10;        org.jsoup.nodes.Document doc = org.jsoup.Jsoup.parse(html);&#10;        AsinSnapshotDTO s = ScrapeParser.parse(doc);&#10;&#10;        // 标题&#10;        assertEquals(&quot;Fire TV Stick&quot;, s.getTitle());&#10;        // 价格&#10;        assertEquals(new java.math.BigDecimal(&quot;45.99&quot;), s.getPrice());&#10;        // BSR&#10;        assertEquals(2345, s.getBsr());&#10;        // 库存（解析出仅剩数量）&#10;        assertEquals(7, s.getInventory());&#10;        // 主图 MD5&#10;        assertNotNull(s.getImageMd5());&#10;        // A+ 内容 MD5&#10;        assertNotNull(s.getAplusMd5());&#10;        // 五点要点包含三行&#10;        assertNotNull(s.getBulletPoints());&#10;        String[] bulletLines = s.getBulletPoints().split(&quot;\n&quot;);&#10;        assertEquals(3, bulletLines.length);&#10;        // 评论总数与评分&#10;        assertEquals(1234, s.getTotalReviews());&#10;        assertEquals(new java.math.BigDecimal(&quot;4.6&quot;), s.getAvgRating());&#10;        // 差评 MD5 应存在&#10;        assertNotNull(s.getLatestNegativeReviewMd5());&#10;    }&#10;&#10;    @Test&#10;    public void parse_mockAmazonProductHtml_shouldExtractAllKeyFields() throws Exception {&#10;        String html = java.nio.file.Files.readString(java.nio.file.Path.of(&quot;src/test/resources/mock-amazon-product.html&quot;));&#10;        org.jsoup.nodes.Document doc = org.jsoup.Jsoup.parse(html);&#10;        AsinSnapshotDTO s = ScrapeParser.parse(doc);&#10;        // 标题&#10;        assertTrue(s.getTitle().contains(&quot;Sample Product Title&quot;));&#10;        // 价格&#10;        assertEquals(new java.math.BigDecimal(&quot;59.99&quot;), s.getPrice());&#10;        // BSR&#10;        assertEquals(1567, s.getBsr());&#10;        // 库存（only 5 left -&gt; 5）&#10;        assertEquals(5, s.getInventory());&#10;        // 五点要点&#10;        assertNotNull(s.getBulletPoints());&#10;        assertEquals(5, s.getBulletPoints().split(&quot;\n&quot;).length);&#10;        // A+ 内容&#10;        assertNotNull(s.getAplusMd5());&#10;        // 评论总数与评分&#10;        assertEquals(2345, s.getTotalReviews());&#10;        assertEquals(new java.math.BigDecimal(&quot;4.4&quot;), s.getAvgRating());&#10;        // 差评 MD5&#10;        assertNotNull(s.getLatestNegativeReviewMd5());&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/spyglass-backend/src/test/resources/mock-amazon-product.html">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/spyglass-backend/src/test/resources/mock-amazon-product.html" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot; /&gt;&#10;    &lt;title&gt;Sample Product Title – 4K Streaming Device with Voice Remote&lt;/title&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;!-- 主图区域 --&gt;&#10;&lt;div id=&quot;imgTagWrapperId&quot;&gt;&#10;    &lt;img id=&quot;landingImage&quot; src=&quot;https://images-na.ssl-images-amazon.com/images/I/TEST-MAIN-IMAGE._AC_SL1500_.jpg&quot; alt=&quot;Sample Product&quot; /&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;!-- 价格区域：多种可能结构 --&gt;&#10;&lt;div id=&quot;corePriceDisplay_desktop_feature_div&quot;&gt;&#10;    &lt;span class=&quot;a-price aok-align-center&quot; data-a-color=&quot;price&quot;&gt;&#10;        &lt;span class=&quot;a-offscreen&quot;&gt;$59.99&lt;/span&gt;&#10;    &lt;/span&gt;&#10;&lt;/div&gt;&#10;&lt;span id=&quot;priceblock_ourprice&quot; style=&quot;display:none&quot;&gt;$59.99&lt;/span&gt;&#10;&#10;&lt;!-- 库存 / 供货状态 --&gt;&#10;&lt;div id=&quot;availability&quot;&gt;&#10;    &lt;span class=&quot;a-size-medium a-color-success&quot;&gt;Only 5 left in stock.&lt;/span&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;!-- 五点要点（Feature Bullets） --&gt;&#10;&lt;div id=&quot;feature-bullets&quot;&gt;&#10;    &lt;ul class=&quot;a-unordered-list a-vertical a-spacing-mini&quot;&gt;&#10;        &lt;li class=&quot;a-list-item&quot;&gt;Ultra HD streaming support&lt;/li&gt;&#10;        &lt;li class=&quot;a-list-item&quot;&gt;Voice remote with TV controls&lt;/li&gt;&#10;        &lt;li class=&quot;a-list-item&quot;&gt;Dolby Vision and HDR10+&lt;/li&gt;&#10;        &lt;li class=&quot;a-list-item&quot;&gt;Wi-Fi 6E enabled for faster networking&lt;/li&gt;&#10;        &lt;li class=&quot;a-list-item&quot;&gt;Energy efficient low power mode&lt;/li&gt;&#10;    &lt;/ul&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;!-- BSR 区域 (细节模块) --&gt;&#10;&lt;div id=&quot;detailBullets_feature_div&quot;&gt;&#10;    &lt;ul&gt;&#10;        &lt;li&gt;&lt;span&gt;Best Sellers Rank: #1,567 in Electronics (See Top 100 in Electronics)&lt;/span&gt;&lt;/li&gt;&#10;    &lt;/ul&gt;&#10;&lt;/div&gt;&#10;&lt;div id=&quot;SalesRank&quot; style=&quot;display:none&quot;&gt;#1,567 in Electronics&lt;/div&gt;&#10;&#10;&lt;!-- A+ 内容区域 --&gt;&#10;&lt;div id=&quot;aplus&quot;&gt;&#10;    &lt;div class=&quot;aplus-module&quot;&gt;&#10;        &lt;h3&gt;Enhanced Performance Module&lt;/h3&gt;&#10;        &lt;p&gt;Experience next-gen speed and clarity with optimized streaming pipeline.&lt;/p&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;!-- 评论汇总 --&gt;&#10;&lt;span id=&quot;acrCustomerReviewText&quot;&gt;2,345 ratings&lt;/span&gt;&#10;&lt;span data-hook=&quot;rating-out-of-text&quot;&gt;4.4 out of 5&lt;/span&gt;&#10;&#10;&lt;!-- 评论列表（用于差评抓取） --&gt;&#10;&lt;div class=&quot;a-section review&quot;&gt;&#10;    &lt;span class=&quot;a-icon-alt&quot;&gt;5.0 out of 5 stars&lt;/span&gt;&#10;    &lt;span class=&quot;review-date&quot;&gt;Reviewed on Oct 12 2025&lt;/span&gt;&#10;    &lt;span class=&quot;review-text&quot;&gt;Absolutely fantastic streaming quality!&lt;/span&gt;&#10;&lt;/div&gt;&#10;&lt;div class=&quot;a-section review&quot;&gt;&#10;    &lt;span class=&quot;a-icon-alt&quot;&gt;2.0 out of 5 stars&lt;/span&gt;&#10;    &lt;span class=&quot;review-date&quot;&gt;Reviewed on Oct 13 2025&lt;/span&gt;&#10;    &lt;span class=&quot;review-text&quot;&gt;Remote stopped responding after two days.&lt;/span&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>