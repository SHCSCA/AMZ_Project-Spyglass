# V2.1 功能验收报告

> 最后更新：2025-11-23

本文档基于 `dev` 分支当前代码，对 PRD《亚马逊竞品情报系统 V2.1》中的功能项进行核查，列出已完成功能、覆盖范围及待办事项，便于产品与研发同步。

---

## 构建与环境
- 运行 `./mvnw -DskipTests package` 构建成功，可启动后端服务。
- `springdoc-openapi` 持续生效，所有新增接口已自动出现在 `/swagger-ui/index.html` 与 `/v3/api-docs`。

---

## 核心能力落地情况

| 模块 | PRD 编号 | 实现要点 | 代码位置 / 说明 |
| --- | --- | --- | --- |
| 代理稳定性 | F-STABLE-001 | 逐请求注入 `Proxy-Authorization`，失败熔断 10 分钟 | `scraper/HttpClientScraper.fetchWithProxy`、`scraper/JsoupScraper.attachProxy`、`scraper/ProxyManager`、`scraper/ProxyInstance` |
| Selenium 隔离 | F-STABLE-002 | 远程 `RemoteWebDriver`、信号量限流、按需释放 | `scraper/SeleniumScraper`、`config/ScraperProperties` |
| JPA 预加载 | F-STABLE-003 | `@EntityGraph("group")` 覆盖所有 `findAll` | `repository/AsinRepository` |
| 真实库存 | F-DATA-001 | 999 加购法取量、提示文本解析 | `scraper/SeleniumScraper.scrapeInventoryBy999Method`、`scraper/ScrapeParser.parseInventoryFromAlert` |
| 促销抓取 | F-DATA-002 | 解析 Coupon/秒杀并入库 | `scraper/ScrapeParser`、`model/AsinHistoryModel` 中 `couponValue`、`isLightningDeal` 字段 |
| 关键词排名 | F-BIZ-001 | 关键词配置 CRUD + 定时抓取排名 | `controller/AsinKeywordsController`、`service/AsinKeywordsService`、`scheduler/KeywordRankScheduler`、`scraper/SeleniumScraper.fetchKeywordRank`、`model/AsinKeywords`、`model/KeywordRankHistory` |
| 成本与利润 | F-BIZ-002 | 成本配置 CRUD、利润计算接口 | `controller/AsinCostsController`、`service/AsinCostsService`、`model/AsinCosts`、`dto/AsinCostsDto` |

---

## 文档同步
- `README.md` 已新增 “V2.1 新增 API（成本配置 & 关键词监控）” 章节，覆盖全部新接口。
- OpenAPI 注解位于新建 Controller 上，自动生成外部文档。

---

## 待办事项
- **F-BIZ-003 评论情感 AI 摘要：** 当前代码库未见相关实现，需要补充调用 LLM 的流程，并在 `AlertService` 中串联。
- `pom.xml` 存在重复依赖警告（`spring-boot-starter-validation`），建议后续清理。
- 建议补充针对 999 加购和关键词调度的自动化测试，提升回归可靠性。

---

## 验证建议
1. 在测试库执行附录 SQL（PRD 附录）以确保表结构齐备。
2. 通过 Swagger 测试以下流程：
   - 成本配置：POST → GET → 计算利润。
   - 关键词管理：POST → GET → PUT → DELETE。
3. 运行一次定时任务（可手动调用 `KeywordRankScheduler.scrapeKeywordRanks()`）验证关键词历史写入。
4. 通过 Selenium 抓取真实库存，检查 `asin_history.inventory` 字段更新。

---

> 若后续有新功能上线，请更新本文件并同步 README，以保持文档与实现一致。
